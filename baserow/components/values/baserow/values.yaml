# Official Baserow Helm Chart Configuration
# https://artifacthub.io/packages/helm/baserow-chart/baserow

global:
  baserow:
    image:
      tag: "{{.nuon.inputs.inputs.baserow_release}}"
    domain: "{{.nuon.install.sandbox.outputs.nuon_dns.public_domain.name}}"
    backendDomain: "api.{{.nuon.install.sandbox.outputs.nuon_dns.public_domain.name}}"
    serviceAccount:
      shared: true
      create: true
      annotations:
        eks.amazonaws.com/role-arn: "{{.nuon.components.baserow_s3_bucket.outputs.role_arn}}"

backendConfigMap:
  BASEROW_EXTRA_ALLOWED_HOSTS: "*"
  DONT_UPDATE_FORMULAS_AFTER_MIGRATION: "yes"
  SYNC_TEMPLATES_ON_STARTUP: "false"
  MIGRATE_ON_STARTUP: "true"
  # AWS S3 Configuration
  AWS_STORAGE_BUCKET_NAME: "{{.nuon.components.baserow_s3_bucket.outputs.bucket_name}}"
  AWS_S3_REGION_NAME: "{{.nuon.components.baserow_s3_bucket.outputs.region}}"
  AWS_S3_CUSTOM_DOMAIN: "{{.nuon.components.baserow_s3_bucket.outputs.bucket_name}}.s3.{{.nuon.components.baserow_s3_bucket.outputs.region}}.amazonaws.com"

# Use external S3 instead of MinIO
minio:
  enabled: false

# Backend ASGI configuration
baserow-backend-asgi:
  livenessProbe:
    initialDelaySeconds: 120
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 5
  readinessProbe:
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1500m"

# Frontend configuration
baserow-frontend:
  livenessProbe:
    initialDelaySeconds: 120
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 5
  readinessProbe:
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1500m"

# Celery workers
baserow-celery-worker:
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1500m"

# PostgreSQL configuration (using bitnamilegacy)
postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: bitnamilegacy/postgresql
  auth:
    database: baserow
    username: baserow
    password: baserow

# Redis configuration (using bitnamilegacy)
redis:
  enabled: true
  image:
    registry: docker.io
    repository: bitnamilegacy/redis
  auth:
    enabled: true
    password: baserow

