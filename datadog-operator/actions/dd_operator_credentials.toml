# action
# copies and munges the autogenerated operator secret into a format the chart knows how to use
name    = "dd_operator_creds"
timeout = "2m"

[[triggers]]
type           = "pre-deploy-component"
component_name = "datadog_operator"

[[triggers]]
type = "manual"

[[steps]]
name    = "Copying Secrets for DataDog Operator"
inline_contents = """
#!/usr/bin/env sh

api_key=`kubectl get -n datadog secret datadog-api-key -o json | jq -r '.data.value' | base64 -d`
app_key=`kubectl get -n datadog secret datadog-app-key -o json | jq -r '.data.value' | base64 -d`
kubectl create -n datadog secret generic datadog \
  --save-config    \
  --dry-run=client \
  --from-literal=api-key="$api_key" \
  --from-literal=app-key="$app_key" \
  -o yaml | kubectl apply -f -
"""
